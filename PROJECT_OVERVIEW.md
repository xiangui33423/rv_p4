# ğŸš€ RV-P4: RISC-V + P4 å¯ç¼–ç¨‹äº¤æ¢æœº

<div align="center">

![Badge](https://img.shields.io/badge/Language-SystemVerilog%20%2B%20C-blue)
![Badge](https://img.shields.io/badge/Architecture-RISC--V%20%2B%20P4-brightgreen)
![Badge](https://img.shields.io/badge/Tests-44%2F44%20PASS-success)
![Badge](https://img.shields.io/badge/License-Academic-orange)
![Badge](https://img.shields.io/badge/Version-1.0-blue)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                    â•‘
â•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—  â•‘
â•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â•‘
â•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â•‘
â•‘    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â•‘
â•‘    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•  â•‘
â•‘    â•šâ•â•  â•šâ•â•  â•šâ•â•â•â•      â•šâ•â•     â•šâ•â•  â•šâ•â•   â•šâ•â•â•šâ•â•     â•šâ•â• â•šâ•â•â•â•â•â•   â•‘
â•‘                                                                    â•‘
â•‘        High-Performance Programmable Switch for Datacenters       â•‘
â•‘                                                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**ä¸€ä¸ªé¢å‘æ•°æ®ä¸­å¿ƒçš„é«˜æ€§èƒ½å¯ç¼–ç¨‹äº¤æ¢æœºåŸå‹ï¼Œé›†æˆ RISC-V æ§åˆ¶é¢ä¸ P4 æ•°æ®å¹³é¢**

</div>

---

## ğŸ“Š é¡¹ç›®ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| **RTL ä»£ç ** | SystemVerilogï¼Œ24 çº§ MAU æµæ°´çº¿ |
| **æ§åˆ¶é¢** | XiangShan RISC-V 64-bit æ ¸å¿ƒ |
| **æµ‹è¯•è¦†ç›–** | 44 ä¸ªå•å…ƒ/é›†æˆæµ‹è¯•ï¼ˆ100% PASSï¼‰ |
| **è”åˆä»¿çœŸ** | RTL + C å›ºä»¶ååŒéªŒè¯ |
| **ç«¯å£æ•°** | 32 Ã— å…¨åŒå·¥ä»¥å¤ªç½‘ SerDes |
| **æ•°æ®é¢æ—¶é’Ÿ** | 1.6 GHzï¼ˆç›®æ ‡ï¼‰ |
| **TCAM å®¹é‡** | æ¯çº§ 2048 æ¡ï¼Œå…± 24 çº§ |
| **PHV å®½åº¦** | 4096 bitï¼ˆ512 å­—èŠ‚ï¼‰ |

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RV-P4 ASIC æ•´ä½“æ¶æ„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚          Ingress Packet Port (0-31)                  â”‚     â”‚
â”‚   â”‚                                                      â”‚     â”‚
â”‚   â”‚  [SerDes RX] â†’ [MAC RX] â†’ [Parser] â†’ [Packet Buffer]â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                            â”‚                                  â”‚
â”‚                            â–¼                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚   MAU Stage 0  (IPv4 Route - LPM)                   â”‚     â”‚
â”‚   â”‚   â”œâ”€ TCAM[0:2047] â†’ Longest-Prefix-Match           â”‚     â”‚
â”‚   â”‚   â””â”€ Action SRAM   â†’ Port + Next-Hop MAC           â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                       â–¼                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚   MAU Stage 1  (ACL - Ingress Filter)               â”‚     â”‚
â”‚   â”‚   â”œâ”€ TCAM[0:2047] â†’ (SrcIP, DstIP, DPort)          â”‚     â”‚
â”‚   â”‚   â””â”€ Action SRAM   â†’ Allow | Deny                  â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                       â–¼                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚   MAU Stage 2-6  (FDB, ARP, VLAN, QoS, etc.)        â”‚     â”‚
â”‚   â”‚   â”œâ”€ Stage 2: L2 FDB â†’ Egress Port                 â”‚     â”‚
â”‚   â”‚   â”œâ”€ Stage 3: ARP Punt Trap                        â”‚     â”‚
â”‚   â”‚   â”œâ”€ Stage 4: VLAN Ingress (Tag/Untag)             â”‚     â”‚
â”‚   â”‚   â”œâ”€ Stage 5: DSCP â†’ Traffic Class                â”‚     â”‚
â”‚   â”‚   â””â”€ Stage 6: VLAN Egress Filtering                â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                       â–¼                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚   Traffic Manager (TM)                              â”‚     â”‚
â”‚   â”‚   â”œâ”€ 256 Queues per Port                           â”‚     â”‚
â”‚   â”‚   â”œâ”€ DWRR Scheduler + SP Priority                  â”‚     â”‚
â”‚   â”‚   â”œâ”€ PIR Rate Limiter                              â”‚     â”‚
â”‚   â”‚   â””â”€ Port Shaper                                   â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                       â–¼                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚   Egress Engine (MAC TX)                             â”‚     â”‚
â”‚   â”‚   â”œâ”€ [Packet TX] â†’ [MAC TX] â†’ [SerDes TX]          â”‚     â”‚
â”‚   â”‚   â””â”€ â†’ Out on Port (0-31)                          â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚   Slow Path: Punt to CPU (ARP, Unknown L2, etc.)    â”‚     â”‚
â”‚   â”‚   â””â”€ Punt FIFO â†’ RISC-V Control Plane              â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ–¥ï¸  CONTROL PLANE (Isolated Clock Domain: clk_ctrl)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚   XiangShan RISC-V 64-bit Processor (Nanhu Core)    â”‚     â”‚
â”‚   â”‚   â”œâ”€ Instruction Cache (32 KB I$)                  â”‚     â”‚
â”‚   â”‚   â”œâ”€ Data Cache (32 KB D$)                         â”‚     â”‚
â”‚   â”‚   â”œâ”€ Running @ 1.5 GHz                             â”‚     â”‚
â”‚   â”‚   â””â”€ Architecture: RV64GC (with M, A, F, D)        â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                       â”‚                                       â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚       â”‚               â”‚               â”‚                      â”‚
â”‚       â–¼               â–¼               â–¼                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚  UART  â”‚  â”‚   MMIO BUS   â”‚  â”‚  APB IF  â”‚               â”‚
â”‚   â”‚  CLI   â”‚  â”‚   (0xA000...)â”‚  â”‚  â†’ TUE   â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚       â”‚               â”‚               â”‚                      â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                       â–¼                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  Control Plane Firmware (C Language)                 â”‚     â”‚
â”‚   â”‚  â”œâ”€ route.c     â†’ IPv4 LPM Table Management         â”‚     â”‚
â”‚   â”‚  â”œâ”€ acl.c       â†’ ACL Rule Install/Update           â”‚     â”‚
â”‚   â”‚  â”œâ”€ fdb.c       â†’ L2 FDB Learning + Aging          â”‚     â”‚
â”‚   â”‚  â”œâ”€ arp.c       â†’ ARP Resolution + Caching         â”‚     â”‚
â”‚   â”‚  â”œâ”€ vlan.c      â†’ VLAN Port Membership              â”‚     â”‚
â”‚   â”‚  â”œâ”€ qos.c       â†’ Traffic Class + QoS Config        â”‚     â”‚
â”‚   â”‚  â”œâ”€ cli.c       â†’ UART Command Parser               â”‚     â”‚
â”‚   â”‚  â””â”€ rv_p4_hal.c â†’ MMIO Register I/O                â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ æ•°æ®æµåŠ¨è·¯å¾„

### å¿«é€Ÿè·¯å¾„ï¼ˆFast Pathï¼‰- çº¿é€Ÿè½¬å‘

```
Ingress Packet
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Parser (256Ã—640b TCAM-driven FSM)            â”‚
â”‚  Extract: {SrcMAC, DstMAC, SrcIP, DstIP, Protocol}  â”‚
â”‚           into PHV (Packet Header Vector)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MAU Stage 0: IPv4 LPM Route Match                   â”‚
â”‚  Match Key: {DstIP[31:0]}                            â”‚
â”‚  Action: Set Egress Port + Next-Hop MAC             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MAU Stage 1: ACL Filtering                          â”‚
â”‚  Match Key: {SrcIP, DstIP, Dst-Port}                â”‚
â”‚  Action: FORWARD | DENY                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
         â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
         â”‚           â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚  DROP  â”‚  â”‚ FORWARD  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  MAU Stage 2-6:      â”‚
         â”‚  â”œâ”€ FDB (L2 Lookup)  â”‚
         â”‚  â”œâ”€ VLAN Tagging     â”‚
         â”‚  â”œâ”€ DSCPâ†’QoS         â”‚
         â”‚  â””â”€ Others           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Traffic Manager      â”‚
         â”‚ (DWRR + SP Priority) â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Egress MAC + SerDes â”‚
         â”‚  Transmit Packet     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ…¢é€Ÿè·¯å¾„ï¼ˆSlow Pathï¼‰- CPU Punt

```
Packet matched "Punt Trap" rule
(e.g., ARP Request, Unknown L2)
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Set PHV "punt_en" flag  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Punt FIFO (Slow Path)   â”‚
â”‚  Store Packet + Metadata â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RISC-V Control Plane Interrupt      â”‚
â”‚  (UART / Mailbox Notification)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Firmware (arp.c / fdb.c)            â”‚
â”‚  â”œâ”€ Process Packet (ARP/L2)          â”‚
â”‚  â”œâ”€ Update Table (ARP / FDB)         â”‚
â”‚  â””â”€ Send Reply via TX Punt FIFO      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© æ¨¡å—å±‚æ¬¡ç»“æ„

```
rv_p4_top
â”œâ”€â”€ ğŸ”„ Data Plane (clk_dp @ 1.6GHz)
â”‚   â”œâ”€â”€ Parser
â”‚   â”‚   â”œâ”€â”€ parser_fsm.sv       (256 states, TCAM-driven)
â”‚   â”‚   â”œâ”€â”€ parser_tcam.sv      (256Ã—640b TCAM)
â”‚   â”‚   â””â”€â”€ phv_extract.sv      (Field extraction logic)
â”‚   â”‚
â”‚   â”œâ”€â”€ MAU Pipeline (24 stages)
â”‚   â”‚   â”œâ”€â”€ mau_stage[0].sv     (IPv4 Route - 2K TCAM)
â”‚   â”‚   â”œâ”€â”€ mau_stage[1].sv     (ACL Filter - 2K TCAM)
â”‚   â”‚   â”œâ”€â”€ mau_stage[2-6].sv   (FDB, ARP, VLAN, QoS)
â”‚   â”‚   â”œâ”€â”€ mau_stage[7-23].sv  (Reserved for future use)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Per-Stage:
â”‚   â”‚       â”œâ”€â”€ tcam_match.sv   (Content-Addressable Memory)
â”‚   â”‚       â”œâ”€â”€ action_sram.sv  (Action lookup)
â”‚   â”‚       â””â”€â”€ alu.sv          (Arithmetic/Logic ops)
â”‚   â”‚
â”‚   â”œâ”€â”€ Traffic Manager (TM)
â”‚   â”‚   â”œâ”€â”€ queue_mgmt.sv       (256 queues/port)
â”‚   â”‚   â”œâ”€â”€ scheduler.sv        (DWRR + SP)
â”‚   â”‚   â”œâ”€â”€ rate_limiter.sv     (PIR shaper)
â”‚   â”‚   â””â”€â”€ tm_arb.sv           (Port arbitration)
â”‚   â”‚
â”‚   â”œâ”€â”€ Packet Buffer
â”‚   â”‚   â””â”€â”€ pkt_buffer.sv       (64 MiB SRAM, 1M cells)
â”‚   â”‚
â”‚   â””â”€â”€ MAC Interface
â”‚       â”œâ”€â”€ mac_rx_arb.sv       (32 port RX arbiter)
â”‚       â””â”€â”€ mac_tx_demux.sv     (32 port TX demultiplexer)
â”‚
â”œâ”€â”€ ğŸ›ï¸  Control Plane (clk_ctrl @ 1.5GHz)
â”‚   â”œâ”€â”€ XiangShan Core
â”‚   â”‚   â”œâ”€â”€ rv64gc_cpu.sv       (RISC-V 64-bit)
â”‚   â”‚   â”œâ”€â”€ i_cache.sv          (32 KB I$)
â”‚   â”‚   â””â”€â”€ d_cache.sv          (32 KB D$)
â”‚   â”‚
â”‚   â”œâ”€â”€ MMIO Bus (0xA0000000+)
â”‚   â”‚   â”œâ”€â”€ parser_csr.sv
â”‚   â”‚   â”œâ”€â”€ mau_csr.sv
â”‚   â”‚   â”œâ”€â”€ tm_csr.sv
â”‚   â”‚   â”œâ”€â”€ vlan_csr.sv
â”‚   â”‚   â”œâ”€â”€ qos_csr.sv
â”‚   â”‚   â””â”€â”€ uart.sv
â”‚   â”‚
â”‚   â””â”€â”€ TUE (Table Update Engine)
â”‚       â”œâ”€â”€ tue_apb_if.sv       (APB slave interface)
â”‚       â”œâ”€â”€ tue_shadow.sv       (Shadow TCAM/SRAM)
â”‚       â””â”€â”€ tue_swap.sv         (Atomic pointer swap)
â”‚
â””â”€â”€ ğŸ”— Cross-Domain Bridges
    â”œâ”€â”€ clk_sync_*              (Clock domain crossing)
    â””â”€â”€ rst_sync_*              (Reset synchronizers)
```

---

## ğŸ“¦ é¡¹ç›®æ–‡ä»¶ç»“æ„

```
rv_p4/
â”‚
â”œâ”€â”€ ğŸ“‹ Documentation
â”‚   â”œâ”€â”€ README.md               (æœ¬æ–‡ä»¶)
â”‚   â”œâ”€â”€ PROJECT_OVERVIEW.md     (é¡¹ç›®æ¦‚è§ˆ - æœ¬æ–‡ä»¶)
â”‚   â”œâ”€â”€ architecture.md         (è¯¦ç»†æ¶æ„è®¾è®¡)
â”‚   â”œâ”€â”€ design_spec.md          (ç¡¬ä»¶è§„æ ¼è¯´æ˜)
â”‚   â””â”€â”€ FILES.md                (å®Œæ•´æ–‡ä»¶ç´¢å¼•)
â”‚
â”œâ”€â”€ ğŸ–¥ï¸  RTL (Data Plane - SystemVerilog)
â”‚   â”œâ”€â”€ rtl/include/
â”‚   â”‚   â”œâ”€â”€ rv_p4_pkg.sv        (å…¨å±€å‚æ•° & ç±»å‹å®šä¹‰)
â”‚   â”‚   â””â”€â”€ rv_p4_if.sv         (æ¥å£å£°æ˜)
â”‚   â”‚
â”‚   â”œâ”€â”€ rtl/parser/
â”‚   â”‚   â”œâ”€â”€ p4_parser.sv        (è§£æå™¨ FSM)
â”‚   â”‚   â”œâ”€â”€ parser_tcam.sv      (è§£æå™¨ TCAM)
â”‚   â”‚   â””â”€â”€ phv_extract.sv      (PHV å­—æ®µæå–)
â”‚   â”‚
â”‚   â”œâ”€â”€ rtl/mau/
â”‚   â”‚   â”œâ”€â”€ mau_stage.sv        (MAU çº§æ¨¡æ¿)
â”‚   â”‚   â”œâ”€â”€ mau_tcam.sv         (TCAM åŒ¹é…)
â”‚   â”‚   â”œâ”€â”€ mau_alu.sv          (ALU æ‰§è¡Œ)
â”‚   â”‚   â””â”€â”€ mau_hash.sv         (Hash è®¡ç®—)
â”‚   â”‚
â”‚   â”œâ”€â”€ rtl/tm/
â”‚   â”‚   â”œâ”€â”€ traffic_manager.sv  (æµé‡ç®¡ç†)
â”‚   â”‚   â”œâ”€â”€ scheduler.sv        (DWRR è°ƒåº¦)
â”‚   â”‚   â””â”€â”€ rate_limiter.sv     (é€Ÿç‡é™åˆ¶)
â”‚   â”‚
â”‚   â”œâ”€â”€ rtl/pkt_buffer/
â”‚   â”‚   â””â”€â”€ pkt_buffer.sv       (åŒ…ç¼“å­˜)
â”‚   â”‚
â”‚   â”œâ”€â”€ rtl/tue/
â”‚   â”‚   â”œâ”€â”€ tue.sv              (è¡¨æ›´æ–°å¼•æ“)
â”‚   â”‚   â””â”€â”€ tue_apb_if.sv       (APB æ¥å£)
â”‚   â”‚
â”‚   â”œâ”€â”€ rtl/common/
â”‚   â”‚   â”œâ”€â”€ rst_sync.sv         (å¤ä½åŒæ­¥)
â”‚   â”‚   â””â”€â”€ cdc_*.sv            (æ—¶é’ŸåŸŸè·¨è¶Š)
â”‚   â”‚
â”‚   â””â”€â”€ rtl/top/
â”‚       â”œâ”€â”€ rv_p4_top.sv        (é¡¶å±‚è®¾è®¡)
â”‚       â”œâ”€â”€ ctrl_plane.sv       (æ§åˆ¶é¢é›†æˆ)
â”‚       â””â”€â”€ io_ring.sv          (ç«¯å£æ¥å£)
â”‚
â”œâ”€â”€ âš™ï¸  Control Plane (C Firmware)
â”‚   â”œâ”€â”€ sw/hal/
â”‚   â”‚   â”œâ”€â”€ rv_p4_hal.h         (HAL API å¤´æ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ rv_p4_hal.c         (HAL å®ç° - MMIO é©±åŠ¨)
â”‚   â”‚   â””â”€â”€ table_map.h         (P4 ç¼–è¯‘å™¨ç”Ÿæˆ)
â”‚   â”‚
â”‚   â””â”€â”€ sw/firmware/
â”‚       â”œâ”€â”€ Makefile            (RISC-V ELF æ„å»º)
â”‚       â”œâ”€â”€ link.ld             (é“¾æ¥è„šæœ¬)
â”‚       â”œâ”€â”€ cp_main.c           (ä¸»å‡½æ•° + åˆå§‹åŒ–)
â”‚       â”‚
â”‚       â”œâ”€â”€ vlan.{c,h}          (VLAN ç®¡ç†)
â”‚       â”œâ”€â”€ arp.{c,h}           (ARP/é‚»å±…è¡¨)
â”‚       â”œâ”€â”€ qos.{c,h}           (QoS è°ƒåº¦)
â”‚       â”œâ”€â”€ fdb.{c,h}           (L2 FDB)
â”‚       â”œâ”€â”€ route.{c,h}         (IPv4 è·¯ç”±)
â”‚       â”œâ”€â”€ acl.{c,h}           (ACL è§„åˆ™)
â”‚       â”œâ”€â”€ cli.{c,h}           (UART CLI)
â”‚       â””â”€â”€ cli_cmds.{c,h}      (å‘½ä»¤å®ç°)
â”‚
â”œâ”€â”€ ğŸ§ª Tests & Simulation
â”‚   â”œâ”€â”€ sw/firmware/test/
â”‚   â”‚   â”œâ”€â”€ test_framework.h    (æµ‹è¯•å®å®šä¹‰)
â”‚   â”‚   â”œâ”€â”€ sim_hal.{c,h}       (HAL ä»¿çœŸ)
â”‚   â”‚   â”œâ”€â”€ pkt_model.{c,h}     (PISA åŠŸèƒ½æ¨¡å‹)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ test_main.c         (æµ‹è¯•å…¥å£)
â”‚   â”‚   â”œâ”€â”€ test_vlan.c         (VLAN å•å…ƒæµ‹è¯•)
â”‚   â”‚   â”œâ”€â”€ test_arp.c          (ARP å•å…ƒæµ‹è¯•)
â”‚   â”‚   â”œâ”€â”€ test_qos.c          (QoS å•å…ƒæµ‹è¯•)
â”‚   â”‚   â”œâ”€â”€ test_route.c        (è·¯ç”±å•å…ƒæµ‹è¯•)
â”‚   â”‚   â”œâ”€â”€ test_acl.c          (ACL å•å…ƒæµ‹è¯•)
â”‚   â”‚   â”œâ”€â”€ test_cli.c          (CLI å•å…ƒæµ‹è¯•)
â”‚   â”‚   â”œâ”€â”€ test_integration.c  (é›†æˆæµ‹è¯•)
â”‚   â”‚   â””â”€â”€ test_dp_cosim.c     (è½¯ä»¶æ•°æ®é¢ååŒ)
â”‚   â”‚
â”‚   â””â”€â”€ tb/cosim/
â”‚       â”œâ”€â”€ Makefile            (Verilator æ„å»ºè„šæœ¬)
â”‚       â”œâ”€â”€ cosim_main.cpp      (C++ ä»¿çœŸé©±åŠ¨)
â”‚       â””â”€â”€ testbenches/        (Verilator FIFO æ¨¡å‹)
â”‚
â””â”€â”€ ğŸ“¦ Submodules
    â””â”€â”€ XiangShan/              (RISC-V å¤„ç†å™¨ - git submodule)
        â”œâ”€â”€ src/main/scala/...  (Scala RTL)
        â”œâ”€â”€ difftest/           (éªŒè¯æ¡†æ¶)
        â””â”€â”€ ...
```

---

## ğŸ”Œ æ—¶é’ŸåŸŸä¸æ¥å£

### æ—¶é’Ÿæ¯”ä¾‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Clock Domain Architecture              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  clk_dp:clk_ctrl:clk_mac = 8:4:1       â”‚
â”‚                                         â”‚
â”‚  clk_dp    1.6 GHz  Data plane (fast)   â”‚
â”‚  clk_ctrl  0.8 GHz  Control plane       â”‚
â”‚  clk_mac   0.2 GHz  MAC interface       â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Data Plane  â”‚â—„â”€â”€â–º  TUE Bridge  â”‚   â”‚
â”‚  â”‚ (clk_dp)     â”‚   â”‚ (CDC logic)  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚(clk_ctrl)    â”‚   â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚            â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                     â”‚Control Plane â”‚   â”‚
â”‚                     â”‚  (clk_ctrl)  â”‚   â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### MMIO åœ°å€æ˜ å°„

| åœ°å€èŒƒå›´ | æ¨¡å— | è¯´æ˜ |
|---------|------|------|
| 0xA0000000-0xA0000FFF | Parser CSR | è§£æå™¨é…ç½® |
| 0xA0001000-0xA0001FFF | MAU/TUE | è¡¨æ›´æ–°å¼•æ“ |
| 0xA0002000-0xA0002FFF | TM | æµé‡ç®¡ç†å™¨ |
| 0xA0003000-0xA0003FFF | TUE APB | TUE åŸå­æ¥å£ |
| 0xA0004000-0xA0004FFF | Pkt Buffer | åŒ…ç¼“å†² |
| 0xA0005000-0xA0005FFF | VLAN CSR | VLAN é…ç½® |
| 0xA0006000-0xA0006FFF | QoS CSR | QoS é…ç½® |
| 0xA0007000-0xA0007FFF | Punt FIFO | CPU Punt |
| 0xA0009000-0xA0009FFF | UART | ä¸²å£æ§åˆ¶å° |

---

## ğŸ§ª æµ‹è¯•è¦†ç›–

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          RV-P4 Comprehensive Testing Framework             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Unit Tests (Module-level verification)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ VLAN Management              6 test cases        â”‚
â”‚ âœ“ ARP / Neighbor Table         7 test cases        â”‚
â”‚ âœ“ QoS Scheduling               5 test cases        â”‚
â”‚ âœ“ IPv4 Routing                 3 test cases        â”‚
â”‚ âœ“ ACL Rules                    4 test cases        â”‚
â”‚ âœ“ CLI Commands                 6 test cases        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Integration Tests (Cross-module verification)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Full System Initialization   1 case               â”‚
â”‚ âœ“ ARP Request â†’ Reply Flow     1 case               â”‚
â”‚ âœ“ ARP Reply Learning           1 case               â”‚
â”‚ âœ“ Multi-Stage TCAM             1 case               â”‚
â”‚ âœ“ CLI Multi-Command Sequence   1 case               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Data-Plane Co-Simulation (Software PISA Model)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Packet Processing Pipeline   7 test cases        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RTL Co-Simulation (Verilator + C Firmware)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ IPv4 LPM Routing (RTL)       1 case               â”‚
â”‚ âœ“ L2 FDB Forwarding (RTL)      1 case               â”‚
â”‚ âœ“ ACL Deny (RTL)               1 case               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total: 44 Unit + Integration + RTL Tests
Status: ALL PASS âœ“
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆä»…éœ€ GCCï¼‰

```bash
cd sw/firmware/test
make                    # Build all tests
./test_main             # Run 44 test cases
```

**é¢„æœŸè¾“å‡ºï¼š**
```
RV-P4 Control Plane Unit Tests
================================
[SUITE] VLAN Management (6 cases)
  PASS  VLAN-1
  ...
[SUITE] Integration / System (6 cases)
  PASS  SYS-1
  ...
Results: 44/44 passed  âœ“ ALL PASS
```

### RTL è”åˆä»¿çœŸï¼ˆéœ€è¦ Verilatorï¼‰

```bash
cd tb/cosim
make                    # Verilate RTL + build firmware
./cosim_sim             # Run co-simulation
```

**é¢„æœŸè¾“å‡ºï¼š**
```
RV-P4 RTL Co-Simulation
========================
[ SUITE ] RTL Data-Plane Co-Simulation (3 cases)
  [PASS] CS-RTL-1: IPv4 LPM routing â†’ TX port 3
  [PASS] CS-RTL-2: L2 FDB forwarding â†’ TX port 7
  [PASS] CS-RTL-3: ACL deny â†’ no TX output
Results: 3/3 passed  ALL PASS
```

---

## ğŸ“š åŠŸèƒ½ç‰¹æ€§

### æ•°æ®å¹³é¢åŠŸèƒ½

| åŠŸèƒ½ | çº§æ•° | è¯´æ˜ |
|------|------|------|
| IPv4 LPM è·¯ç”± | Stage 0 | æœ€é•¿å‰ç¼€åŒ¹é…ï¼Œ2048 æ¡ TCAM |
| ACL è¿‡æ»¤ | Stage 1 | (Src, Dst, Port) deny/permit |
| L2 FDB è½¬å‘ | Stage 2 | MAC åœ°å€å­¦ä¹ ä¸è½¬å‘ |
| ARP Punt Trap | Stage 3 | ARP æŠ¥æ–‡ä¸Šé€ CPU |
| VLAN å…¥å£ | Stage 4 | Access/Trunk ç«¯å£å¤„ç† |
| DSCPâ†’QoS | Stage 5 | DSCP åˆ° Traffic Class æ˜ å°„ |
| VLAN å‡ºå£ | Stage 6 | æŒ‰ç«¯å£æˆå‘˜è¿‡æ»¤å’Œæ ‡ç­¾å¤„ç† |
| æµé‡ç®¡ç† | TM | DWRR + SP è°ƒåº¦ï¼ŒPIR é™é€Ÿ |

### æ§åˆ¶é¢åŠŸèƒ½

```
cli> show route
10.0.0.0/8        â†’ port 2, nexthop aa:bb:cc:dd:ee:ff
10.10.0.0/16      â†’ port 3, nexthop 11:22:33:44:55:66

cli> show fdb
de:ad:be:ef:00:01 â†’ port 7 (static)
aa:bb:cc:dd:ee:02 â†’ port 4 (dynamic, age: 120s)

cli> show vlan
VLAN 10: ports [1,2,3] access
VLAN 20: ports [4,5,6(T), 7(T)] trunk

cli> show acl
ACL-1: deny   192.168.0.0/16 â†’ 0.0.0.0/0 port 80
ACL-2: permit 10.0.0.0/8     â†’ 0.0.0.0/0 port 443
```

---

## ğŸ” å…³é”®æŠ€æœ¯äº®ç‚¹

### 1ï¸âƒ£ **P4 å¯ç¼–ç¨‹è§£æå™¨**

```c
// è§£æå™¨ç”± 256 Ã— 640 bit TCAM é©±åŠ¨ï¼Œæ”¯æŒçµæ´»çš„å­—æ®µæå–
parser_fsm_state[256] = {
    // State 0: Start â†’ Ethernet header
    // State 1: Parse Src/Dst MAC â†’ IPv4
    // State 2: Parse IPv4 header â†’ TCP/UDP
    // ...ï¼ˆå¯é€šè¿‡å›ºä»¶åŠ¨æ€æ›´æ–°ï¼‰
};
```

### 2ï¸âƒ£ **åŸå­æµè¡¨æ›´æ–°ï¼ˆShadow-Write + Pointer Swapï¼‰**

```
æ•°æ®é¢æŒç»­å·¥ä½œï¼Œæ— ä¸­æ–­åœ°æ›´æ–° TCAMï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Active TCAM     (æ•°æ®é¢è¯»å–)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Shadow TCAM     (æ§åˆ¶é¢å†™å…¥)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [å†™å…¥å®Œæˆ] â†’ [æŒ‡é’ˆäº¤æ¢] â†’ [æ¿€æ´»]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3ï¸âƒ£ **24 çº§æµæ°´çº¿ MAU**

æ¯çº§ç‹¬ç«‹çš„ TCAM åŒ¹é… + Action SRAMï¼Œå…¨æµæ°´åå **1 PHV/å‘¨æœŸ**

### 4ï¸âƒ£ **Verilator RTL ååŒä»¿çœŸ**

C å›ºä»¶ç›´æ¥é©±åŠ¨ SystemVerilog RTLï¼ŒéªŒè¯ç«¯åˆ°ç«¯æ­£ç¡®æ€§

---

## ğŸ“– æ–‡æ¡£å¯¼èˆª

| æ–‡æ¡£ | å†…å®¹ |
|------|------|
| [README.md](README.md) | é¡¹ç›®å…¥é—¨ã€ç¼–è¯‘ä¸æµ‹è¯• |
| [PROJECT_OVERVIEW.md](PROJECT_OVERVIEW.md) | **æœ¬æ–‡æ¡£** - å¯è§†åŒ–æ¶æ„ä¸è®¾è®¡ |
| [architecture.md](architecture.md) | è¯¦ç»†æ¶æ„è§„æ ¼ä¸æ¥å£å®šä¹‰ |
| [design_spec.md](design_spec.md) | ç¡¬ä»¶ç»†èŠ‚è§„æ ¼è¯´æ˜ |
| [FILES.md](FILES.md) | å®Œæ•´æ–‡ä»¶ç´¢å¼•ä¸æè¿° |

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Technology Stack                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  Hardware Design Language      SystemVerilog 2017  â”‚
â”‚  Processor Architecture        RISC-V RV64GC       â”‚
â”‚  Control Plane Language        C (C11)             â”‚
â”‚  Simulation Framework          Verilator 5.0+      â”‚
â”‚  Build System                  GNU Make            â”‚
â”‚  Testing Framework             Custom C macros     â”‚
â”‚  Documentation                 Markdown            â”‚
â”‚  Version Control               Git                 â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡ï¼ˆç›®æ ‡ï¼‰

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **ååé‡** | 6.4 Tbps | 32 Ã— 200 Gbps SerDes |
| **å»¶è¿Ÿ** | < 100 ns | æ•°æ®è·¯å¾„å»¶è¿Ÿ |
| **è¡¨æŸ¥è¯¢** | 1 æŸ¥è¯¢/å‘¨æœŸ | MAU æµæ°´çº¿ |
| **TCAM å®¹é‡** | 49,152 æ¡ | 24 çº§ Ã— 2K æ¡/çº§ |
| **Action SRAM** | 1.5 M æ¡ | 24 çº§ Ã— 64K æ¡/çº§ |
| **åŒ…ç¼“å­˜** | 64 MiB | 1M Ã— 64 å­—èŠ‚ Cell |
| **è¡¨æ›´æ–°å»¶è¿Ÿ** | 36 æ—¶é’Ÿ | TUE åŸå­æ“ä½œ |

---

## ğŸ“ å­¦ä¹ ä»·å€¼

æœ¬é¡¹ç›®æ¶µç›–ä»¥ä¸‹å­¦ä¹ é¢†åŸŸï¼š

- âœ… **ç¡¬ä»¶è®¾è®¡** - SystemVerilog RTL æ¶æ„ä¸è®¾è®¡æ¨¡å¼
- âœ… **æ•°æ®ç»“æ„** - TCAMã€SRAMã€å“ˆå¸Œè¡¨ç­‰é«˜æ€§èƒ½å­˜å‚¨
- âœ… **åè®®å¤„ç†** - ä»¥å¤ªç½‘ã€IPv4ã€ARPã€VLANã€QoS
- âœ… **æµæ°´çº¿æ¶æ„** - MAU çº§è”ã€å»¶è¿Ÿä¸ååæƒè¡¡
- âœ… **æ—¶é’ŸåŸŸè·¨è¶Š** - CDCï¼ˆClock Domain Crossingï¼‰æŠ€æœ¯
- âœ… **åµŒå…¥å¼ç³»ç»Ÿ** - RISC-V å›ºä»¶å¼€å‘ä¸ HAL æŠ½è±¡
- âœ… **ç¡¬ä»¶-è½¯ä»¶ååŒ** - RTL ä»¿çœŸä¸ååŒéªŒè¯
- âœ… **ç½‘ç»œäº¤æ¢** - æ•°æ®ä¸­å¿ƒäº¤æ¢æœºè®¾è®¡åŸç†

---

## ğŸ“ æ”¯æŒä¸åé¦ˆ

- ğŸ“§ **Issues**: æŠ¥å‘Š Bug æˆ–æå‡ºåŠŸèƒ½å»ºè®®
- ğŸ¤ **Pull Requests**: æ¬¢è¿ä»£ç è´¡çŒ®
- ğŸ“š **Documentation**: å®Œæ•´çš„æ¶æ„å’Œè®¾è®¡æ–‡æ¡£

---

## ğŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾› **å­¦æœ¯ç ”ç©¶ä¸æ•™å­¦ä½¿ç”¨**ã€‚

---

<div align="center">

**Made with â¤ï¸ for Open-Source Hardware Design Community**

â­ å¦‚æœæ‚¨è§‰å¾—æœ‰ç”¨ï¼Œæ¬¢è¿ Starï¼

</div>
